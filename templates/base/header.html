{% load static %}
{% load thumbnail %}
<!-- 引入notifications的模板标签 -->
{% load notifications_tags %}
{% notifications_unread as unread_count %}

<link rel="stylesheet" href="{% static 'css/notification-top-bar.css' %}">

    <div class="notification-top-bar-container" style="display: none;">
        <div class="notification-top-bar">
            <p></p>
        </div>
    </div>
    
    <script src="https://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="{% static 'js/notification-top-bar.js' %}"></script>
    <script>
        $(function () {
            const url = "{% url 'django_top_notify:latest_system_notification' %}";
            get_latest_system_notification(url);
        })
    </script>
<div class="ui flex menu" style="margin-top: 0; display:none;">
    <div class="ui container">
        <a href="/" class="borderless header item">
            <img class="logo" src="{% static 'img/logo.png' %}">
            学霸空间
        </a>
        
        <div class="v-header-extra">
            <div class="ui small icon input v-video-search" data-tooltip="使用回车进行搜索" data-position="bottom center" ;>
                <input class="prompt" value="{{ q }}" type="text" placeholder="搜索" id="v-search"  >
                <i id="search" class="search icon" style="cursor:pointer;"></i>
            </div>
            {% if user.is_authenticated %}
            <div class="ui inline dropdown" id="v-header-avatar" >
                <div class="" style="display:inline-block;font-weight:bold;">
                    {% thumbnail user.avatar "200x200" crop="center" as im %}
                    <img class="ui avatar image" src="{{ im.url }}">
                    {% empty %}
                    <img class="ui avatar image" src="{% static 'img/img_default_avatar.png' %}">
                    {% endthumbnail %}
                    <!-- 新增代码，小红点 -->
                    {% if unread_count %}
                        <svg viewBox="0 0 8 8"
                            width="8px"
                            height="8px">
                            <circle cx="4"
                                    cy="4"
                                    r="4"
                                    fill="#ff6b6b"
                                    ></circle>
                        </svg>
                    {% endif %}
                    {{ user.username }}
                </div>
                <i class="dropdown icon"></i>
                <div class="menu">
                    <div class="item" onclick="window.location='{% url 'notice:list' %}';">
                        <i class="bell icon"></i>
                        <span>通知消息</span>
                            {% if unread_count %}
                            <span>
                                <a class="floating ui tiny red label">{{ unread_count }}</a>
                                
                            </span>
                            {% endif %}
                        
                    </div>
                    <div class="item" onclick="window.location='{% url 'users:profile' user.pk %}';">
                        <i class="user icon"></i>
                        <span>个人资料</span>
                    </div>
                    <div class="item" onclick="window.location='{% url 'users:collect_videos' user.pk %}';">
                        <i class="bookmark icon"></i>
                        <span>我的收藏</span>
                    </div>
                    <div class="item" onclick="window.location='{% url 'users:like_videos' user.pk %}';">
                        <i class="heart icon"></i>
                        <span>我的点赞</span>
                    </div>
                    <div class="item" onclick="window.location='{% url 'history' %}';">
                        <i class="history icon"></i>
                        <span>历史记录</span>
                    </div>
                    {% if user.is_superuser %}
                    <div class="item" onclick="window.location='{% url 'myadmin:index'  %}';">
                        <i class="archive icon"></i>
                        <span>后台管理</span>
                    </div>
                    <div class="item" onclick="window.location='/admin' ">
                        <i class="bug icon"></i>
                        <span>Django </span>
                    </div>
                    <div class="item" onclick="window.location='/api';">
                        <i class="code icon"></i>
                        <span>API 接口</span>
                    </div>
                    <div class="item" onclick="window.location='/docs';">
                        <i class="file alternate icon"></i>
                        <span>API 文档</span>
                    </div>
                    {% endif %}
                    <div class="item" onclick="window.location='{% url 'users:logout' %}';">
                        <i class="sign-out icon"></i>
                        <span>退出</span>
                    </div>
                </div>
            </div>
            {% else %}
            <a class="ui tiny secondary basic button" id="v-header-login" href="{% url 'users:login' %}?next={{ request.path }}">登录</a>
            {% endif %}

        </div>
    </div>
</div>
<style>
    .ui.floating.label{
         margin: 0 0 0 -2em!important;
         
     }
 </style>